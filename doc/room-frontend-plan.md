# IDC 机房管理模块 - 前端开发计划

## 一、项目概述

### 1.1 功能目标

- 机房可管理、直观提现机房信息、机房状态、机房容量等
- 机柜可管理、直观提现机柜信息、机柜状态、机柜容量
- 机房内机柜可管理：机房内机柜管理->机柜设备管理
- 实现 IDC 机房 2D/2.5D 可视化管理系统
- 支持机房内机柜的拖拽编辑和可视化展示
- 支持机柜内设备的 U 位可视化管理
- 与 CMDB 系统集成获取设备资产数据

### 1.2 技术栈

- 框架: React 17.0 + TypeScript
- UI 库: Ant Design 4.23.0
- 可视化: 基于 React + CSS Transform
- 路由: React Router 5.2.0
- 状态管理: React Hooks + Context
- 构建工具: Vite 2.9.18

---

## 二、页面结构设计

### 2.1 路由规划

```
/idc                     # IDC管理主页面（Tab页）
  ├─> /idc/rooms         # 机房管理 Tab（默认）
  │     ├─> /idc/rooms           # 机房列表页
  │     └─> /idc/rooms/:id        # 机房详情页（包含可视化画布）
  │           └─> /idc/rooms/:id/racks/:rackId  # 机柜详情页（U位管理）
  └─> /idc/racks         # 机柜管理 Tab
        └─> /idc/racks           # 机柜列表页（独立管理）
```

**说明：**

- 使用 Tab 页设计，将机房管理和机柜管理分离
- 机房管理 Tab：主要管理机房及其内部机柜布局
- 机柜管理 Tab：独立管理所有机柜，支持 CRUD 操作
- 在机房详情页添加机柜时，从机柜管理中选择已创建的机柜

### 2.2 页面层级关系

```
IDC管理主页面 (/idc)
  ├─> 机房管理 Tab (/idc/rooms)
  │     └─> 机房列表页 (/idc/rooms)
  │           └─> 机房详情页 (/idc/rooms/:id)
  │                 ├─> 可视化画布视图（主视图）
  │                 ├─> 机柜列表视图（侧边栏）
  │                 ├─> 机柜选择弹窗（从机柜管理中选择）
  │                 └─> 机柜详情弹窗/抽屉
  │                       └─> U位管理视图
  │                             └─> 设备选择弹窗（CMDB集成）
  └─> 机柜管理 Tab (/idc/racks)
        └─> 机柜列表页 (/idc/racks)
              ├─> 机柜创建/编辑弹窗
              └─> 机柜详情查看
```

---

## 三、UI 布局设计

### 3.1 机房列表页 (`/rooms`)

#### 3.1.1 整体布局

```
┌─────────────────────────────────────────────────────────┐
│  PageHeader: IDC机房管理                                │
│  [搜索框] [筛选器] [新建机房] [刷新]                    │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐            │
│  │ 机房卡片  │  │ 机房卡片  │  │ 机房卡片  │            │
│  │          │  │          │  │          │            │
│  │ 名称/编号 │  │ 名称/编号 │  │ 名称/编号 │            │
│  │ 状态标签 │  │ 状态标签 │  │ 状态标签 │            │
│  │ 统计信息 │  │ 统计信息 │  │ 统计信息 │            │
│  [分页器]                                               │
│  │ [详情]   │  │ [详情]   │  │ [详情]   │            │
│  [分页器]                                               │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

#### 3.1.2 功能区域

**顶部操作栏：**

- 搜索框：支持机房名称、编号、地址模糊搜索
- 筛选器：状态筛选（全部/活跃/维护/停用）、类型筛选、等级筛选
- 操作按钮：新建机房、批量操作、刷新、导出

**机房卡片展示：**

- 卡片式布局，响应式网格（每行 3-4 个）
- 卡片信息：
  - 机房名称（大标题）
  - 机房编号（副标题）
  - 状态标签（Badge，颜色区分）
  - 关键统计信息（机柜数、设备数、U 位使用率、功率使用率）
  - 快速操作按钮（详情、编辑、删除）

---

### 3.2 机房详情页 (`/rooms/:id`)

#### 3.2.1 整体布局（三栏布局）

```
┌─────────────────────────────────────────────────────────────┐
│  PageHeader: 机房名称 [返回] [编辑] [统计] [设置]           │
├──────────┬──────────────────────────────────┬──────────────┤
│          │                                  │              │
│  左侧栏   │        可视化画布区域              │   右侧栏     │
│  (300px) │        (自适应，主要区域)          │  (350px)    │
│          │                                  │              │
│ ┌──────┐ │  ┌──────────────────────────┐   │ ┌──────────┐ │
│ │工具栏 │ │  │                          │   │ │机房信息  │ │
│ │      │ │  │    机柜可视化画布          │   │ │          │ │
│ │[+]   │ │  │    (支持拖拽、缩放)        │   │ │基本信息  │ │
│ │[-]   │ │  │                          │   │ │统计信息  │ │
│ │[↻]   │ │  │  ┌──┐  ┌──┐  ┌──┐      │   │ │容量信息  │ │
│ │[保存]│ │  │  │机柜│  │机柜│  │机柜│      │   │          │ │
│ │[导出]│ │  │  └──┘  └──┘  └──┘      │   │ └──────────┘ │
│ │      │ │  │                          │   │              │
│ └──────┘ │  └──────────────────────────┘   │ ┌──────────┐ │
│          │                                  │ │机柜列表  │ │
│ ┌──────┐ │                                  │ │          │ │
│ │视图  │ │                                  │ │[搜索]    │ │
│ │      │ │                                  │ │[筛选]    │ │
│ │[2D]  │ │                                  │ │          │ │
│ │[2.5D]│ │                                  │ │机柜1     │ │
│ │[列表]│ │                                  │ │机柜2     │ │
│ └──────┘ │                                  │ │机柜3     │ │
│          │                                  │ │...       │ │
│          │                                  │ └──────────┘ │
└──────────┴──────────────────────────────────┴──────────────┘
```

#### 3.2.2 左侧工具栏（固定宽度 300px）

**工具组：**

- 添加机柜按钮（打开机柜创建弹窗）

- 缩放控制：放大、缩小、重置、适应窗口
- 视图切换：2D 视图、2.5D 视图、列表视图
- 操作按钮：保存布局、导出图片、全屏
- 网格开关：显示/隐藏网格辅助线
- 标尺开关：显示/隐藏标尺

**机柜操作：**

- 从机柜管理列表中选择机柜
- 支持搜索和筛选
- 批量选择多个机柜添加到当前机房
- 批量选择模式
  - 悬停显示机柜信息提示
- 删除选中机柜

#### 3.2.3 中间可视化画布（自适应，主要区域）

**画布功能：**

- 机柜横向排列,自动换行
- 机柜不能重叠
- 机柜等比例仿真
- 机柜底部：显示功率使用情况
- 机柜内容竖向排列
- 支持拖拽移动
- 点击选中，显示选中边框
- 网格背景（可选）
- 标尺（可选，显示米/像素单位）

**交互：**

- 单击机柜：选中机柜，右侧栏显示机柜详情
- 双击机柜：打开机柜详情抽屉（U 位管理）
- 拖拽机柜：移动机柜位置
- 右键菜单：编辑、删除、查看详情

#### 3.2.4 右侧信息栏（固定宽度 350px）

**机房信息卡片：**

- 基本信息：名称、编号、地址、类型、等级、状态
- 联系人信息：联系人、联系电话
- 描述信息

**统计信息卡片：**

- 机柜统计：总数、已用、可用
- 设备统计：总数
- U 位统计：总数、已用、使用率（进度条）
- 功率统计：总容量、已用、使用率（进度条）
- 告警统计：当前告警数

**机柜列表：**

- 搜索框：快速搜索机柜
- 筛选器：状态筛选、容量筛选
- 列表项：
  - 机柜编号/名称
  - 状态标签
  - U 位使用率（进度条）
  - 设备数量
  - 操作按钮（详情、编辑、删除）
- 点击列表项：画布定位到对应机柜并选中

---

### 3.3 机柜详情视图（抽屉/弹窗）

#### 3.3.1 布局设计

```
┌─────────────────────────────────────────────────────────┐
│  机柜详情: A01                    [关闭] [编辑] [删除]  │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ┌──────────────┐  ┌──────────────────────────────┐   │
│  │ 机柜信息卡片  │  │    U位可视化区域               │   │
│  │              │  │                              │   │
│  │ 基本信息      │  │  42U ┌──────────────────┐   │   │
│  │ 容量信息      │  │  41U │                  │   │   │
│  │ 功率信息      │  │  ... │   设备可视化      │   │   │
│  │ 网络端口      │  │  2U  │   支持拖拽调整    │   │   │
│  │              │  │  1U  └──────────────────┘   │   │
│  └──────────────┘  │                              │   │
│                    │  [添加设备] [批量操作]       │   │
│  ┌──────────────┐  └──────────────────────────────┘   │
│  │ 设备列表      │                                      │
│  │              │                                      │
│  │ [搜索]       │                                      │
│  │              │                                      │
│  │ 设备1        │                                      │
│  │ 设备2        │                                      │
│  │ ...          │                                      │
│  └──────────────┘                                      │
└─────────────────────────────────────────────────────────┘
```

#### 3.3.2 U 位可视化区域

**U 位展示：**

- 垂直排列，42 个 U 位（标准机柜）
- 每个 U 位显示：
  - U 位编号（1-42）
  - 占用状态（颜色区分：已用/空闲/预留）
  - 设备信息（设备名称、类型图标）
- 支持拖拽调整设备位置
- 支持点击设备查看详情

**操作：**

- 添加设备按钮：打开 CMDB 设备选择弹窗
- 批量操作：批量移动、批量删除
- 右键菜单：编辑设备、移除设备、查看详情

#### 3.3.3 设备列表

- 搜索框：设备名称、IP 搜索
- 列表项：
  - 设备名称
  - 设备类型图标
  - U 位范围（如：5-6U）
  - 状态标签
  - 操作按钮（编辑、移除）
- 点击列表项：U 位区域高亮对应设备

---

### 3.4 IDC 管理主页面（Tab 页布局）

#### 3.4.1 整体布局

```
┌─────────────────────────────────────────────────────────┐
│  PageHeader: IDC机房管理                                │
├─────────────────────────────────────────────────────────┤
│  [Tab: 机房管理] [Tab: 机柜管理]                        │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ┌─────────────────────────────────────────────────┐ │
│  │                                                   │ │
│  │        当前 Tab 对应的页面内容                      │ │
│  │                                                   │ │
│  │  - 机房管理 Tab：显示机房列表页                    │ │
│  │  - 机柜管理 Tab：显示机柜列表页                    │ │
│  │                                                   │ │
│  └─────────────────────────────────────────────────┘ │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

**Tab 页设计：**

- **机房管理 Tab（默认）：** 显示机房列表页，功能同 3.1 节
- **机柜管理 Tab：** 显示机柜列表页，独立管理所有机柜
- Tab 切换：使用 Ant Design 的 Tabs 组件，支持路由同步

---

### 3.5 机柜管理页面 (`/idc/racks`)

#### 3.5.1 整体布局

```
┌─────────────────────────────────────────────────────────┐
│  PageHeader: 机柜管理                                   │
│  [搜索框] [筛选器] [新建机柜] [批量操作] [刷新] [导出] │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ┌──────────────────────────────────────────────────┐ │
│  │  机柜列表（Table 表格）                             │ │
│  │                                                    │ │
│  │  编号 │ 名称 │ 所属机房 │ U位 │ 功率 │ 状态 │ 操作 │ │
│  │  ────┼─────┼─────────┼────┼────┼────┼──── │ │
│  │  A01 │ A01 │ 核心机房A│15/42│3.5/10│活跃│[详情]│ │
│  │  A02 │ A02 │ 核心机房A│20/42│5.0/10│活跃│[详情]│ │
│  │  B01 │ B01 │ 核心机房B│10/42│2.0/10│维护│[详情]│ │
│  │  ... │ ... │   ...   │ ... │ ... │ ... │ ... │ │
│  │                                                    │ │
│  └──────────────────────────────────────────────────┘ │
│                                                         │
│  [分页器]                                               │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

#### 3.5.2 功能区域

**顶部操作栏：**

- **搜索框：** 支持机柜编号、名称、所属机房名称模糊搜索
- **筛选器：**
  - 状态筛选：全部/活跃/维护/停用
  - 所属机房筛选：下拉选择机房
  - 容量筛选：U 位使用率（<50% / 50-80% / 80-95% / >95%）
  - 功率筛选：功率使用率（<50% / 50-80% / 80-95% / >95%）
- **操作按钮：**
  - 新建机柜：打开机柜创建弹窗
  - 批量操作：批量编辑、批量删除、批量导出
  - 刷新：刷新列表数据
  - 导出：导出机柜列表为 Excel

**机柜列表（Table 表格）：**

**表格列设计：**

1. **选择列（可选）：** 复选框，支持批量选择
2. **机柜编号：** 可点击，跳转到机柜详情或打开详情弹窗
3. **机柜名称：** 显示机柜名称
4. **所属机房：** 显示所属机房名称（可点击跳转到机房详情）
5. **U 位信息：**
   - 显示格式：`已用U/总U`（如：15/42）
   - 使用率进度条（颜色区分：绿色/蓝色/橙色/红色）
   - 悬停显示详细使用率百分比
6. **功率信息：**
   - 显示格式：`已用功率/总容量`（如：3.5/10 KW）
   - 使用率进度条（颜色区分）
   - 悬停显示详细使用率百分比
7. **网络端口：**
   - 显示格式：`已用/总数`（如：20/24）
   - 可选显示
8. **设备数量：** 显示机柜内设备总数
9. **状态：** 状态标签（Badge）
   - 活跃：绿色
   - 维护：橙色
   - 停用：灰色
10. **操作列：**
    - 详情：打开机柜详情抽屉（U 位管理）
    - 编辑：打开机柜编辑弹窗
    - 删除：删除机柜（需确认，如有设备需先移除设备）

**列表交互：**

- 点击行：选中行，显示详情信息（可选）
- 双击行：打开机柜详情抽屉
- 排序：支持按编号、名称、U 位使用率、功率使用率、设备数量排序
- 分页：支持分页，每页显示 20/50/100 条

---

### 3.6 机柜创建/编辑弹窗

#### 3.6.1 布局设计

```
┌─────────────────────────────────────────────────────────┐
│  新建机柜 / 编辑机柜                    [×]            │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ┌─────────────────────────────────────────────────┐ │
│  │  基本信息                                        │ │
│  │                                                  │ │
│  │  机柜名称 *    [____________]                    │ │
│  │  机柜编号 *    [____________]                    │ │
│  │  所属机房      [下拉选择______]                  │ │
│  │  机柜状态      [○活跃 ○维护 ○停用]              │ │
│  │  描述          [____________]                    │ │
│  │                [____________]                    │ │
│  └─────────────────────────────────────────────────┘ │
│                                                         │
│  ┌─────────────────────────────────────────────────┐ │
│  │  容量配置                                        │ │
│  │                                                  │ │
│  │  总U数 *        [42]  (标准机柜：42U)            │ │
│  │  功率容量(KW) * [10.0]                          │ │
│  │  网络端口数     [24]                             │ │
│  └─────────────────────────────────────────────────┘ │
│                                                         │
│  ┌─────────────────────────────────────────────────┐ │
│  │  位置信息（可选，用于机房布局）                    │ │
│  │                                                  │ │
│  │  X坐标(米)      [0.0]                            │ │
│  │  Y坐标(米)      [0.0]                            │ │
│  │  旋转角度       [0°]  (0° 或 90°)               │ │
│  └─────────────────────────────────────────────────┘ │
│                                                         │
│                    [取消]  [确定]                      │
└─────────────────────────────────────────────────────────┘
```

#### 3.6.2 表单字段说明

**基本信息：**

- **机柜名称（必填）：** 机柜显示名称，如 "A01"
- **机柜编号（必填）：** 机柜唯一编号，如 "RACK-A01"，需验证唯一性
- **所属机房（可选）：** 下拉选择机房，创建时可选择，编辑时可修改
- **机柜状态（必填）：** 单选，活跃/维护/停用
- **描述（可选）：** 机柜描述信息，多行文本

**容量配置：**

- **总 U 数（必填）：** 机柜总 U 数，默认 42U，支持自定义（如 45U、48U）
- **功率容量（必填）：** 机柜功率容量，单位 KW，如 10.0
- **网络端口数（可选）：** 机柜网络端口总数，如 24

**位置信息（可选）：**

- **X 坐标：** 机柜在机房中的 X 坐标（米或像素）
- **Y 坐标：** 机柜在机房中的 Y 坐标（米或像素）
- **旋转角度：** 机柜旋转角度，0° 或 90°

**表单验证：**

- 机柜编号：必填，唯一性验证，格式验证（建议：字母数字组合）
- 总 U 数：必填，范围验证（1-100）
- 功率容量：必填，数值验证，> 0

---

### 3.7 机柜选择弹窗（用于机房详情页添加机柜）

#### 3.7.1 布局设计

```
┌─────────────────────────────────────────────────────────┐
│  选择机柜                    [×]                        │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  [搜索框] [筛选器：状态/所属机房]                        │
│                                                         │
│  ┌─────────────────────────────────────────────────┐ │
│  │  机柜列表（Table，支持多选）                       │ │
│  │                                                  │ │
│  │  ☑ │ 编号 │ 名称 │ 所属机房 │ U位 │ 功率 │ 状态 │ │
│  │  ──┼─────┼─────┼─────────┼────┼────┼──── │ │
│  │  ☐ │ A01 │ A01 │ 核心机房A│15/42│3.5/10│活跃│ │
│  │  ☐ │ A02 │ A02 │ 核心机房A│20/42│5.0/10│活跃│ │
│  │  ☐ │ B01 │ B01 │ 核心机房B│10/42│2.0/10│维护│ │
│  │  ... │ ... │ ... │   ...   │ ... │ ... │ ... │ │
│  │                                                  │ │
│  └─────────────────────────────────────────────────┘ │
│                                                         │
│  [分页器]                                               │
│                                                         │
│  已选择：2 个机柜                                       │
│                    [取消]  [确定(2)]                    │
└─────────────────────────────────────────────────────────┘
```

#### 3.7.2 功能说明

**使用场景：**

- 在机房详情页，点击"添加机柜"按钮
- 打开机柜选择弹窗，显示所有可用的机柜
- 支持多选，选择多个机柜后批量添加到当前机房

**筛选逻辑：**

- **默认筛选：** 显示所有机柜（包括已分配到其他机房的机柜）
- **可选筛选：** 仅显示未分配机房的机柜（推荐）
- **状态筛选：** 仅显示活跃状态的机柜（推荐）

**交互流程：**

1. 用户点击"添加机柜"按钮
2. 打开机柜选择弹窗，显示机柜列表
3. 用户搜索、筛选机柜
4. 用户勾选一个或多个机柜（支持全选）
5. 点击"确定"按钮
6. 系统验证：
   - 如果机柜已分配到其他机房，提示用户确认
   - 如果机柜已分配到当前机房，跳过或提示
7. 批量添加机柜到当前机房
8. 刷新机房详情页，画布显示新添加的机柜

**已选机柜提示：**

- 显示已选择的机柜数量
- 显示已选机柜列表（可选，悬停或点击查看）

---

### 3.8 机柜详情查看（只读模式）

#### 3.8.1 布局设计

在机柜管理页面，点击"详情"按钮，可以打开机柜详情查看弹窗或抽屉，显示机柜的完整信息。

**详情内容：**

1. **基本信息：**

   - 机柜名称、编号
   - 所属机房（可点击跳转）
   - 状态、描述

2. **容量信息：**

   - U 位：已用/总数，使用率（进度条）
   - 功率：已用/总容量，使用率（进度条）
   - 网络端口：已用/总数，使用率（进度条）

3. **位置信息：**

   - X 坐标、Y 坐标、旋转角度
   - 在机房中的位置示意图（可选）

4. **设备列表：**

   - 显示机柜内所有设备
   - 设备名称、类型、U 位范围、状态
   - 可点击查看设备详情

5. **操作按钮：**
   - 编辑：打开编辑弹窗
   - 删除：删除机柜
   - 查看 U 位管理：打开 U 位管理抽屉

---

#### 4.1.1 RoomListPage (机房列表页)

- 搜索框：设备名称、IP 搜索
- 列表项：
  - 设备名称
  - 设备类型图标
  - U 位范围（如：5-6U）
- 机房列表展示
- 搜索和筛选
- 分页
- 新建/编辑/删除机房
  - 状态标签
  - 操作按钮（编辑、移除）
- 点击列表项：U 位区域高亮对应设备

---

- `RoomSearchBar` - 搜索栏
- `RoomFilter` - 筛选器
- `RoomCreateModal` - 创建机房弹窗
- `RoomEditModal` - 编辑机房弹窗

### 4.1 页面级组件

#### 4.1.1 RoomListPage (机房管理页面)

- 搜索和筛选
- 新建/编辑/删除机柜
- Excel 导入机柜
- 查看机柜详情

**子组件：**

- `RackList` - 机柜列表

- `RackDetailModal` - 机柜详情弹窗

---

#### 4.1.2 RoomDetailPage (机房详情页)

**路径：** `src/pages/room/Detail/index.tsx`

**功能：**

- 机房可视化画布
- 机柜管理
- 统计信息展示

**子组件：**

- `RoomCanvas` - 可视化画布
- `RoomToolbar` - 左侧工具栏
- `RoomInfoPanel` - 右侧信息面板
- `RackDetailDrawer` - 机柜详情抽屉

---

#### 4.1.3 RackDetailDrawer (机柜详情抽屉)

**路径：** `src/pages/room/components/RackDetailDrawer/index.tsx`

**功能：**

- U 位可视化
- 设备管理
- 机柜信息展示

**子组件：**

- `UUnitVisualization` - U 位可视化组件
- `DeviceList` - 设备列表
- `DeviceSelectModal` - 设备选择弹窗（CMDB 集成）

---

#### 4.1.4 IDCMainPage (IDC 管理主页面)

**路径：** `src/pages/idc/index.tsx`

**功能：**

- Tab 页管理（机房管理、机柜管理）
- 路由同步
- 页面切换

**子组件：**

- `RoomListPage` - 机房列表页
- `RackListPage` - 机柜列表页

---

#### 4.1.5 RackListPage (机柜管理页面)

**路径：** `src/pages/rack/List/index.tsx`

**功能：**

- 机柜列表展示（Table 表格）
- 搜索和筛选
- 新建/编辑/删除机柜
- 批量操作
- 导出功能

**子组件：**

- `RackTable` - 机柜列表表格
- `RackSearchBar` - 搜索栏
- `RackFilter` - 筛选器
- `RackCreateModal` - 创建机柜弹窗
- `RackEditModal` - 编辑机柜弹窗
- `RackDetailModal` - 机柜详情弹窗
- `RackSelectModal` - 机柜选择弹窗（用于机房详情页添加机柜）

---

### 4.2 业务组件

#### 4.2.1 RoomCard (机房卡片)

**路径：** `src/pages/room/components/RoomCard/index.tsx`

**Props：**

```typescript
interface RoomCardProps {
  room: Room;
  onView: (id: number) => void;
  onEdit: (id: number) => void;
  onDelete: (id: number) => void;
}
```

**展示内容：**

- 机房名称（大标题）
- 机房编号（副标题）
- 状态标签（Badge）
- 统计信息（机柜数、设备数、U 位使用率、功率使用率）
- 操作按钮

---

#### 4.2.2 RoomCanvas (机房可视化画布)

**路径：** `src/pages/room/components/RoomCanvas/index.tsx`

**Props：**

```typescript
interface RoomCanvasProps {
#### 4.2.3 RackElement (机柜元素)
  roomId: number;
  racks: Rack[];
  layout: RoomLayout;
  onRackSelect: (rackId: number) => void;
  onRackMove: (rackId: number, x: number, y: number) => void;
  onRackRotate: (rackId: number, rotation: number) => void;
  onLayoutSave: (layout: RoomLayout) => void;
}
```

**功能：**

- 画布渲染（基于 CSS Transform）
- 机柜元素渲染
- 拖拽交互
- 缩放和平移
- 网格和标尺

**子组件：**

- `RackElement` - 机柜元素
- 机柜矩形渲染
- 显示机柜编号
- 显示容量状态（颜色区分）

---

#### 4.2.3 RackElement (机柜元素 - 等比例仿真)

- 旋转控制

**路径：** `src/pages/room/components/RackElement/index.tsx`

**Props：**

```typescript
interface RackElementProps {
  rack: Rack;
  position: { x: number; y: number };
  rotation: number;
  selected: boolean;
  onSelect: () => void;
  onMove: (x: number, y: number) => void;
  onRotate: (rotation: number) => void;
  onDoubleClick: () => void;
}
```

**功能：**

- 显示容量状态（颜色区分：绿色/蓝色/橙色/红色）
- 拖拽移动

---

#### 4.2.4 UUnitVisualization (U 位可视化)

**路径：** `src/pages/room/components/UUnitVisualization/index.tsx`

**Props：**

```typescript
interface UUnitVisualizationProps {
  rack: Rack;
  devices: RackDevice[];
  onDeviceAdd: (startU: number, heightU: number) => void;
  onDeviceMove: (deviceId: number, startU: number) => void;
  onDeviceRemove: (deviceId: number) => void;
  onDeviceSelect: (deviceId: number) => void;
}
```

**功能：**

- 42 个 U 位垂直排列
- 设备占用可视化
- 拖拽调整设备位置
- 点击查看设备详情
- 添加设备交互

**子组件：**

- `UUnitItem` - 单个 U 位项
- `DeviceBlock` - 设备块

---

#### 4.2.5 DeviceSelectModal (设备选择弹窗)

**路径：** `src/pages/room/components/DeviceSelectModal/index.tsx`

**Props：**

```typescript
interface DeviceSelectModalProps {
  visible: boolean;
  gids?: number[]; // 资产模型ID，用于筛选设备类型
  excludeDeviceIds?: number[]; // 排除已选设备
  onSelect: (device: CMDBAsset) => void;
  onCancel: () => void;
}
```

**功能：**

- CMDB 设备列表查询
- 搜索和筛选
- 设备信息展示
- 设备选择确认

**集成：**

- 调用 `GET /cmdb/assets` 接口
- 支持按资产模型筛选（gids 参数）
- 支持搜索（query 参数）

---

#### 4.2.6 RoomStatistics (机房统计面板)

**路径：** `src/pages/room/components/RoomStatistics/index.tsx`

**Props：**

```typescript
interface RoomStatisticsProps {
  roomId: number;
  statistics: RoomStatistics;
}
```

**功能：**

- 统计信息展示
- 进度条可视化
- 实时刷新

---

#### 4.2.7 RackTable (机柜列表表格)

**路径：** `src/pages/rack/components/RackTable/index.tsx`

**Props：**

```typescript
interface RackTableProps {
  racks: Rack[];
  loading: boolean;
  selectedRowKeys: number[];
  onSelect: (selectedRowKeys: number[]) => void;
  onView: (rackId: number) => void;
  onEdit: (rackId: number) => void;
  onDelete: (rackId: number) => void;
  onSort: (field: string, order: 'asc' | 'desc') => void;
}
```

**功能：**

- 机柜列表展示（Ant Design Table）
- 支持多选
- 支持排序
- 显示容量使用率进度条
- 操作按钮（详情、编辑、删除）

---

#### 4.2.8 RackCreateModal (机柜创建弹窗)

**路径：** `src/pages/rack/components/RackCreateModal/index.tsx`

**Props：**

```typescript
interface RackCreateModalProps {
  visible: boolean;
  onOk: (data: RackCreateData) => Promise<void>;
  onCancel: () => void;
  initialRoomId?: number; // 可选，如果从机房详情页打开，预填所属机房
}
```

**功能：**

- 机柜创建表单
- 表单验证
- 机柜编号唯一性验证
- 提交创建

**表单字段：**

- 基本信息：名称、编号、所属机房、状态、描述
- 容量配置：总 U 数、功率容量、网络端口数
- 位置信息：X 坐标、Y 坐标、旋转角度（可选）

---

#### 4.2.9 RackEditModal (机柜编辑弹窗)

**路径：** `src/pages/rack/components/RackEditModal/index.tsx`

**Props：**

```typescript
interface RackEditModalProps {
  visible: boolean;
  rackId: number;
  onOk: (rackId: number, data: RackUpdateData) => Promise<void>;
  onCancel: () => void;
}
```

**功能：**

- 机柜编辑表单
- 加载机柜数据
- 表单验证
- 提交更新

---

#### 4.2.10 RackSelectModal (机柜选择弹窗)

**路径：** `src/pages/rack/components/RackSelectModal/index.tsx`

**Props：**

```typescript
interface RackSelectModalProps {
  visible: boolean;
  multiple?: boolean; // 是否支持多选，默认 true
  excludeRackIds?: number[]; // 排除已选机柜
  filterRoomId?: number; // 可选，筛选特定机房的机柜
  onSelect: (rackIds: number[]) => void;
  onCancel: () => void;
}
```

**功能：**

- 机柜列表展示（Table，支持多选）
- 搜索和筛选
- 批量选择
- 选择确认

**使用场景：**

- 机房详情页添加机柜时使用
- 支持多选，批量添加机柜到机房

---

#### 4.2.11 RackDetailModal (机柜详情弹窗)

**路径：** `src/pages/rack/components/RackDetailModal/index.tsx`

**Props：**

```typescript
interface RackDetailModalProps {
  visible: boolean;
  rackId: number;
  onEdit: () => void;
  onDelete: () => void;
  onViewUUnits: () => void; // 查看U位管理
  onCancel: () => void;
}
```

**功能：**

- 机柜详情展示（只读）
- 基本信息、容量信息、位置信息
- 设备列表
- 操作按钮（编辑、删除、查看 U 位管理）

---

### 4.3 通用组件

#### 4.3.1 RoomToolbar (工具栏)

**路径：** `src/pages/room/components/RoomToolbar/index.tsx`

**功能：**

- 缩放控制
- 视图切换
- 操作按钮
- 网格/标尺开关

---

#### 4.3.2 RoomInfoPanel (信息面板)

**路径：** `src/pages/room/components/RoomInfoPanel/index.tsx`

**功能：**

- 机房信息展示
- 统计信息展示
- 机柜列表展示

---

## 五、数据流设计

### 5.1 状态管理

**使用 Context + Hooks：**

```typescript
// RoomContext
interface RoomContextValue {
  currentRoom: Room | null;
  racks: Rack[];
  layout: RoomLayout | null;
  selectedRack: Rack | null;
  loading: boolean;
  refreshRoom: () => Promise<void>;
  refreshRacks: () => Promise<void>;
  updateLayout: (layout: RoomLayout) => Promise<void>;
}
```

### 5.2 API 调用

**服务层：** `src/services/room.ts`

```typescript
// 机房相关API
export const getRoomList = (params: RoomListParams) => Promise<RoomListResponse>;
export const getRoomDetail = (id: number) => Promise<Room>;
export const createRoom = (data: RoomCreateData) => Promise<Room>;
export const updateRoom = (id: number, data: RoomUpdateData) => Promise<void>;
export const deleteRoom = (id: number) => Promise<void>;
export const getRoomStatistics = (id: number) => Promise<RoomStatistics>;
export const updateRoomLayout = (id: number, layout: RoomLayoutData) => Promise<void>;

// 机柜相关API
export const getRackList = (params: RackListParams) => Promise<RackListResponse>;
export const getRackDetail = (id: number) => Promise<Rack>;
export const createRack = (data: RackCreateData) => Promise<Rack>;
export const updateRack = (id: number, data: RackUpdateData) => Promise<void>;
export const deleteRack = (id: number) => Promise<void>;
export const getRackStatistics = (id: number) => Promise<RackStatistics>;
export const batchAddRacksToRoom = (roomId: number, rackIds: number[]) => Promise<void>;

// 设备相关API
export const addDeviceToRack = (rackId: number, data: DeviceAddData) => Promise<RackDevice>;
export const updateDevicePosition = (rackId: number, deviceId: number, data: DevicePositionData) => Promise<void>;
export const removeDeviceFromRack = (rackId: number, deviceId: number) => Promise<void>;
export const checkUPosition = (rackId: number, data: UPositionCheckData) => Promise<UPositionCheckResult>;

// CMDB集成API
export const getCMDBDevices = (params: CMDBDeviceListParams) => Promise<CMDBDeviceListResponse>;
export const getCMDBDeviceDetail = (id: number) => Promise<CMDBAsset>;
```

---

## 六、交互设计

### 6.1 机房列表页交互

1. **搜索交互：**

   - 输入关键词，实时搜索（防抖 500ms）
   - 支持回车搜索
   - 清空按钮

2. **筛选交互：**

   - 下拉选择筛选条件
   - 多条件组合筛选
   - 显示当前筛选条件标签，支持快速清除

3. **卡片交互：**

   - 悬停显示阴影效果
   - 点击卡片进入详情页
   - 操作按钮悬停高亮

4. **新建机房：**
   - 点击新建按钮，打开表单弹窗
   - 表单验证
   - 提交成功后刷新列表

---

### 6.2 机房详情页交互

1. **画布交互：**

   - 拖拽平移（鼠标中键或空格+左键）
   - 机柜拖拽移动（左键拖拽）
   - 机柜旋转（选中后右键菜单或快捷键 R）
   - 双击机柜打开详情抽屉

2. **工具栏交互：**

   - 缩放按钮：点击放大/缩小，支持快捷键
   - 视图切换：切换 2D/2.5D/列表视图
   - 保存布局：自动保存或手动保存，显示保存状态

3. **机柜列表交互：**
   - 点击列表项：画布定位并选中对应机柜
   - 搜索机柜：实时过滤列表
   - 操作按钮：快速编辑/删除

---

### 6.3 机柜详情交互

1. **U 位可视化交互：**

   - 点击 U 位：显示可用 U 位范围，打开设备选择弹窗
   - 拖拽设备：调整设备在 U 位中的位置
   - 悬停设备：显示设备详细信息提示
   - 右键设备：显示操作菜单（编辑、移除、查看详情）

2. **设备添加交互：**

   - 点击添加设备：打开 CMDB 设备选择弹窗
   - 选择设备：确认后选择 U 位位置
   - U 位验证：自动检查 U 位冲突，提示冲突信息
   - 确认添加：提交后刷新 U 位视图

- **Excel 导入：** 支持批量导入机房、机柜数据
- **Excel 导出：** 导出机房列表、机柜列表、设备列表
- **布局导出：** 导出机房布局图为 PNG/SVG
- **数据模板：** 提供导入模板下载

3. **设备列表交互：**
   - 点击列表项：U 位区域高亮对应设备
   - 搜索设备：实时过滤列表
   - 操作按钮：快速编辑/移除
     **实现优先级：** 中

---

### 6.4 机柜管理页面交互

1. **Tab 切换交互：**

   - 点击 Tab 切换机房管理和机柜管理
   - Tab 切换时保持路由同步
   - 切换时保留当前页面的筛选条件（可选）

2. **搜索和筛选交互：**

   - 搜索框：输入关键词，实时搜索（防抖 500ms）
   - 筛选器：下拉选择筛选条件，多条件组合筛选
   - 显示当前筛选条件标签，支持快速清除
   - 筛选条件变化时自动刷新列表

3. **列表交互：**

   - 点击行：选中行（可选，用于批量操作）
   - 双击行：打开机柜详情弹窗
   - 点击机柜编号：打开机柜详情弹窗
   - 点击所属机房：跳转到机房详情页
   - 排序：点击列头排序，支持多列排序（可选）

4. **新建机柜交互：**

   - 点击"新建机柜"按钮，打开创建弹窗
   - 表单验证：实时验证，提交前完整验证
   - 机柜编号唯一性验证：失焦时验证，提示冲突
   - 提交成功后刷新列表，显示成功提示

5. **编辑机柜交互：**

   - 点击"编辑"按钮，打开编辑弹窗
   - 加载机柜数据，填充表单
   - 表单验证同新建
   - 提交成功后刷新列表，更新对应行数据

6. **删除机柜交互：**

   - 点击"删除"按钮，显示确认对话框
   - 检查机柜是否有设备：
     - 如有设备，提示"请先移除机柜内的设备"
     - 如无设备，确认后删除
   - 删除成功后刷新列表，显示成功提示

7. **批量操作交互：**

   - 勾选多个机柜（支持全选）
   - 点击"批量操作"按钮，显示操作菜单
   - 批量编辑：打开批量编辑弹窗，修改共同字段
   - 批量删除：显示确认对话框，批量删除
   - 批量导出：导出选中机柜为 Excel

8. **机柜选择交互（用于机房详情页添加机柜）：**
   - 在机房详情页点击"添加机柜"按钮
   - 打开机柜选择弹窗
   - 搜索和筛选机柜
   - 勾选一个或多个机柜
   - 点击"确定"按钮
   - 系统验证并批量添加机柜到当前机房
   - 刷新机房详情页，画布显示新添加的机柜

---

## 七、样式设计

### 7.1 设计规范

**颜色方案：**

- 主色调：使用系统主题色
- 状态颜色：
  - 活跃/在线：绿色 (#52c41a)
  - 维护中：橙色 (#faad14)
  - 停用/离线：灰色 (#d9d9d9)
  - 告警：红色 (#ff4d4f)
- U 位状态：
  - 已用：蓝色系 (#1890ff)
  - 空闲：浅灰色 (#f0f0f0)
  - 预留：黄色系 (#faad14)

**间距规范：**

- 卡片间距：16px
- 组件内边距：12px-16px
- 画布网格：20px

**字体规范：**

- 标题：16px，加粗
- 正文：14px
- 辅助文字：12px

---

### 7.2 响应式设计

**断点：**

- 桌面端：≥1200px（三栏布局）
- 平板端：768px-1199px（两栏布局，隐藏左侧工具栏）
- 移动端：<768px（单栏布局，抽屉式侧边栏）

---

## 八、功能布局讨论

### 8.1 布局方案对比

- **优点：** 信息展示完整，操作便捷，符合专业工具使用习惯
- **缺点：** 需要较大屏幕空间
- **适用场景：** 桌面端，专业运维人员

---

### 8.2 可视化视图方案

#### 2D 视图

- **优点：** 性能好，交互简单，适合精确布局
- **缺点：** 视觉效果一般
- **实现：** 基于 CSS Transform 的平面布局

#### 2.5D 视图

- **优点：** 视觉效果更好，更直观
- **缺点：** 实现复杂，性能开销较大
- **实现：** CSS 3D Transform + 阴影效果

**推荐：** 优先实现 2D 视图，2.5D 视图作为可选功能

---

### 8.3 U 位管理方案

- **优点：** 符合机柜实际布局，直观易懂
- **缺点：** 需要滚动查看完整列表
- **实现：** 垂直排列的 U 位列表

**详细设计建议：**

1. **U 位可视化布局：**

   - 采用垂直列表，从上到下显示 42U（或自定义 U 数）
   - 每个 U 位高度建议 20-25px，确保设备信息清晰可见
   - 支持虚拟滚动，当 U 位数量较多时提升性能
   - 左侧显示 U 位编号，右侧显示设备信息

2. **设备块展示：**

   - 设备块跨多个 U 位时，使用绝对定位或 flex 布局
   - 设备块颜色区分：在线（绿色）、离线（灰色）、告警（红色）、维护（橙色）
   - 设备块显示关键信息：设备名称、设备类型图标、U 位范围
   - 悬停显示完整设备信息（Tooltip）

3. **交互优化：**
   - 点击空白 U 位：高亮显示可用 U 位范围，打开设备选择弹窗
   - 拖拽设备：实时显示目标 U 位，验证冲突后更新位置
   - 右键菜单：编辑、移除、查看详情、查看 CMDB 信息
   - 批量选择：支持 Ctrl/Cmd 多选设备，批量操作

---

### 8.4 机房详情页布局优化讨论

#### 8.4.1 三栏布局合理性分析

**当前设计：左侧工具栏(300px) + 中间画布(自适应) + 右侧信息栏(350px)**

**优点：**

- 信息展示完整，无需频繁切换页面
- 操作便捷，工具栏和信息栏常驻可见
- 符合专业工具的使用习惯（如 CAD、设计工具）

**潜在问题：**

- 小屏幕（<1400px）时，画布区域可能过窄
- 左右固定宽度可能不够灵活

**优化建议：**

1. **响应式调整：**

   - 屏幕宽度 <1400px：左侧工具栏可折叠为图标模式
   - 屏幕宽度 <1200px：右侧信息栏改为抽屉式，点击展开
   - 提供全屏画布模式，隐藏左右栏，专注布局编辑

2. **布局可配置：**
   - 允许用户自定义左右栏宽度（拖拽调整）
   - 支持保存用户布局偏好（localStorage）

#### 8.4.2 画布区域设计讨论

**机柜排列方案：**

1. **方案 A：自由拖拽布局（推荐）**

   - 机柜可任意拖拽到画布任意位置
   - 支持网格对齐、智能对齐（机柜间距自动对齐）
   - 适合精确布局，符合实际机房规划需求
   - **实现：** 使用 react-draggable 或自定义拖拽

2. **方案 B：自动排列布局**
   - 机柜自动横向排列，自动换行
   - 适合快速查看，不适合精确布局
   - **实现：** CSS Grid 或 Flexbox 自动布局

**推荐：** 优先实现方案 A，方案 B 作为"快速布局"模式可选

**机柜尺寸设计：**

- 标准机柜尺寸：宽度 600mm（0.6m），深度 1000mm（1.0m）
- 画布比例：建议 1:1 或 1:2（宽度:深度），便于真实反映机房布局
- 机柜在画布上的显示尺寸：建议 60px × 100px（可缩放）
- 支持自定义机柜尺寸（非标准机柜）

**机柜信息展示：**

- 机柜顶部：显示机柜编号/名称
- 机柜主体：颜色表示容量状态
  - 绿色：使用率 < 50%
  - 蓝色：使用率 50-80%
  - 橙色：使用率 80-95%
  - 红色：使用率 > 95% 或告警
- 机柜底部：显示 U 位使用率进度条（可选）
- 机柜侧面：显示功率使用情况（可选）

#### 8.4.3 右侧信息栏内容组织

**信息层级设计：**

1. **机房信息卡片（固定顶部）**

   - 基本信息：名称、编号、地址、类型、等级、状态
   - 联系人信息：联系人、联系电话
   - 描述信息（可折叠）

2. **统计信息卡片（重要，常驻）**

   - 机柜统计：总数、已用、可用（进度条）
   - 设备统计：总数
   - U 位统计：总数、已用、使用率（进度条 + 百分比）
   - 功率统计：总容量、已用、使用率（进度条 + 百分比）
   - 告警统计：当前告警数（可点击跳转）

3. **机柜列表（可滚动）**
   - 搜索框：实时过滤机柜列表
   - 筛选器：状态、容量使用率筛选
   - 列表项：机柜编号、状态标签、U 位使用率、设备数量、操作按钮
   - 点击列表项：画布定位到对应机柜并选中（平滑滚动）

**优化建议：**

- 统计信息卡片支持刷新按钮，手动更新统计数据
- 机柜列表支持排序：按编号、按使用率、按设备数量
- 机柜列表支持批量选择，批量操作（删除、移动等）

---

### 8.5 机柜详情抽屉布局讨论

#### 8.5.1 抽屉尺寸和位置

**设计建议：**

- 抽屉宽度：建议 800-1000px，确保 U 位可视化和设备列表并排显示
- 抽屉位置：从右侧滑出（符合 Ant Design 设计规范）
- 抽屉高度：全屏高度，内容区域可滚动

#### 8.5.2 内容区域布局

**推荐布局：上下分栏**

```
┌─────────────────────────────────────┐
│ 机柜信息卡片（固定顶部，不可滚动）    │
├─────────────────┬───────────────────┤
│                 │                   │
│  U位可视化区域   │   设备列表区域     │
│  (左侧，60%)     │   (右侧，40%)      │
│                 │                   │
│  可滚动          │   可滚动           │
└─────────────────┴───────────────────┘
```

**优点：**

- U 位可视化和设备列表同时可见，便于对照
- 信息密度适中，不会过于拥挤

**备选布局：左右分栏**

- U 位可视化在左侧，设备列表在右侧
- 适合宽屏显示，但需要确保 U 位区域足够宽

#### 8.5.3 设备选择弹窗设计

**弹窗布局：**

- 宽度：1000-1200px
- 高度：600-800px
- 内容区域：
  - 顶部：搜索框、筛选器（资产模型、状态等）
  - 中间：设备列表（Table 组件，支持分页）
  - 底部：已选设备预览、操作按钮（确定、取消）

**设备列表字段：**

- 设备名称
- IP 地址
- 设备类型
- 状态
- 所属机房/机柜（如果已分配）
- 操作：选择按钮

**交互流程：**

1. 用户点击"添加设备"或点击空白 U 位
2. 打开设备选择弹窗，显示可用的 CMDB 设备
3. 用户搜索、筛选、选择设备
4. 确认后，返回 U 位选择（如果点击的是空白 U 位，自动定位到该 U 位）
5. 用户选择 U 位范围，系统验证冲突
6. 确认添加，刷新 U 位视图

---

### 8.6 数据同步和实时更新讨论

#### 8.6.1 数据同步策略

**问题：** 多个用户同时编辑同一机房时，如何保证数据一致性？

**解决方案：**

1. **乐观更新 + 冲突检测（推荐）**

   - 用户操作立即更新本地状态，提升响应速度
   - 保存时检查数据版本，如有冲突提示用户
   - 适合大多数场景，用户体验好

2. **实时同步（WebSocket）**

   - 使用 WebSocket 实时同步布局变更
   - 其他用户的操作实时反映到当前用户界面
   - 适合需要多人协作的场景
   - **实现优先级：** 低（初期可不实现）

3. **定期轮询**
   - 定期（如 30 秒）刷新机房数据
   - 检测到数据变更时提示用户刷新
   - 实现简单，但实时性较差

**推荐：** 初期使用方案 1，后续根据需求考虑方案 2

#### 8.6.2 布局保存策略

**自动保存 vs 手动保存：**

1. **自动保存（推荐）**

   - 用户拖拽机柜后，延迟 2-3 秒自动保存（防抖）
   - 减少用户操作步骤，避免数据丢失
   - 显示保存状态提示（保存中/已保存/保存失败）

2. **手动保存**
   - 用户点击"保存布局"按钮才保存
   - 适合需要批量操作后再保存的场景
   - 需要提示用户未保存的更改

**推荐：** 采用自动保存 + 手动保存按钮（用户可手动触发保存）

---

### 8.7 错误处理和用户反馈

#### 8.7.1 错误场景处理

1. **API 调用失败：**

   - 网络错误：显示友好提示，提供重试按钮
   - 权限错误：提示用户无权限，引导联系管理员
   - 数据冲突：提示冲突信息，提供解决方案（如刷新后重试）

2. **数据验证失败：**

   - U 位冲突：高亮显示冲突的设备，提示用户调整
   - 容量超限：提示容量不足，显示当前使用情况
   - 必填字段缺失：表单验证，字段级别错误提示

3. **操作失败：**
   - 删除失败：提示失败原因（如机柜中有设备，需先移除设备）
   - 保存失败：保留用户输入，提供重试功能

#### 8.7.2 加载状态设计

- **页面加载：** 显示 Skeleton 加载骨架屏
- **数据刷新：** 显示 Spin 加载动画，不阻塞用户操作
- **操作提交：** 按钮显示 loading 状态，禁用重复提交

---

### 8.8 机柜管理页面设计讨论

#### 8.8.1 Tab 页设计合理性

**设计方案：使用 Tab 页分离机房管理和机柜管理**

**优点：**

- **职责清晰：** 机房管理和机柜管理分离，各自独立
- **操作便捷：** 机柜管理独立页面，支持完整的 CRUD 操作
- **数据管理：** 可以统一管理所有机柜，不受机房限制
- **复用性：** 机柜可以在多个机房间复用（通过机柜选择功能）

**潜在问题：**

- 用户可能需要在机房和机柜之间频繁切换
- Tab 切换可能打断用户的工作流

**优化建议：**

1. **Tab 切换保持状态：** Tab 切换时保留当前页面的筛选条件和滚动位置
2. **快速跳转：** 在机柜列表中点击"所属机房"，快速跳转到机房详情页
3. **新窗口打开：** 支持右键在新标签页打开（可选）

#### 8.8.2 机柜列表表格设计

**表格列设计要点：**

1. **容量信息展示：**

   - U 位信息：显示 `已用/总数`，配合进度条可视化
   - 功率信息：显示 `已用/总容量`，配合进度条可视化
   - 进度条颜色：绿色（<50%）、蓝色（50-80%）、橙色（80-95%）、红色（>95%）
   - 悬停显示详细使用率百分比

2. **所属机房显示：**

   - 显示机房名称（可点击跳转）
   - 如果机柜未分配机房，显示"未分配"（灰色）
   - 支持按所属机房筛选

3. **状态管理：**

   - 状态标签颜色区分：活跃（绿色）、维护（橙色）、停用（灰色）
   - 支持按状态筛选

4. **操作按钮：**
   - 详情：打开详情弹窗（只读）
   - 编辑：打开编辑弹窗
   - 删除：删除机柜（需确认）

#### 8.8.3 机柜创建/编辑表单设计

**表单字段组织：**

1. **基本信息（必填）：**

   - 机柜名称、编号：基础标识
   - 所属机房：可选，创建时可选择，编辑时可修改
   - 状态：活跃/维护/停用

2. **容量配置（必填）：**

   - 总 U 数：默认 42U，支持自定义
   - 功率容量：单位 KW
   - 网络端口数：可选

3. **位置信息（可选）：**
   - X 坐标、Y 坐标、旋转角度
   - 仅在机柜分配到机房后才有意义
   - 可在机房详情页的布局编辑中设置

**表单验证规则：**

- 机柜编号：必填，唯一性验证（调用后端接口验证）
- 总 U 数：必填，范围 1-100
- 功率容量：必填，数值 > 0
- 机柜编号格式：建议字母数字组合，如 "RACK-A01"

#### 8.8.4 机柜选择功能设计

**使用场景：**

- 在机房详情页，用户需要添加机柜到当前机房
- 从机柜管理中选择已创建的机柜，而不是在机房详情页直接创建

**设计要点：**

1. **筛选逻辑：**

   - 默认显示所有机柜（包括已分配到其他机房的）
   - 可选筛选：仅显示未分配机房的机柜（推荐）
   - 可选筛选：仅显示活跃状态的机柜（推荐）

2. **多选支持：**

   - 支持多选，批量添加机柜到机房
   - 显示已选择机柜数量
   - 支持全选/取消全选

3. **冲突处理：**

   - 如果机柜已分配到其他机房，提示用户确认
   - 如果机柜已分配到当前机房，跳过或提示

4. **添加后处理：**
   - 批量添加机柜到机房后，刷新机房详情页
   - 画布自动显示新添加的机柜
   - 机柜位置信息可在布局编辑中设置

#### 8.8.5 机柜与机房的关系管理

**关系设计：**

- **机柜独立管理：** 机柜可以在机柜管理页面独立创建和管理
- **机房关联：** 机柜通过 `roomId` 字段关联到机房
- **灵活分配：** 机柜可以在不同机房间移动（通过编辑所属机房）

**数据一致性：**

- 机柜删除时，检查是否有设备，如有设备需先移除设备
- 机柜删除时，如果已分配到机房，需要处理关联关系
- 机房删除时，需要处理机柜的关联关系（可选：将机柜设为未分配状态）

---

### 8.9 未考虑到的功能点补充

#### 8.8.1 机柜模板功能

**建议功能：**

- **机柜模板：** 预设常用机柜配置（如标准 42U 机柜、高密度机柜等）
- **快速创建：** 基于模板快速创建机柜，减少配置时间
- **模板管理：** 支持创建、编辑、删除机柜模板

**实现优先级：** 中

#### 8.8.2 设备快速搜索和定位

**建议功能：**

- **全局设备搜索：** 在机房详情页提供全局搜索框，快速定位设备
- **设备定位：** 搜索到设备后，自动定位到对应机柜并高亮显示
- **跨机房搜索：** 支持在所有机房中搜索设备

**实现优先级：** 高（提升用户体验）

#### 8.8.3 机柜分组和标签

**建议功能：**

- **机柜分组：** 支持将机柜分组（如按业务线、按区域），分组显示
- **机柜标签：** 支持为机柜添加标签，便于分类和筛选
- **分组管理：** 支持创建、编辑、删除分组

**实现优先级：** 中

#### 8.8.4 布局导入导出

**建议功能：**

- **布局导出：** 导出机房布局为图片（PNG/SVG）或 JSON 文件
- **布局导入：** 支持从 JSON 文件导入布局（批量创建机柜）
- **布局模板：** 保存常用布局为模板，快速应用到新机房

**实现优先级：** 中

#### 8.8.5 设备详情快速查看

**建议功能：**

- **设备详情弹窗：** 点击设备后，显示设备详情弹窗（不跳转页面）
- **详情内容：** 设备基本信息、CMDB 信息、监控数据（如 CPU、内存使用率）
- **快速操作：** 在详情弹窗中提供快速操作（编辑、移除、查看 CMDB）

**实现优先级：** 高（提升操作效率）

#### 8.8.6 机柜容量预警

**建议功能：**

- **容量预警：** U 位使用率、功率使用率超过阈值时，显示预警提示
- **预警配置：** 支持配置预警阈值（如 U 位使用率 > 90% 预警）
- **预警展示：** 在机柜卡片、统计面板中显示预警信息

**实现优先级：** 高（重要业务功能）

#### 8.8.7 操作确认和撤销

**建议功能：**

- **危险操作确认：** 删除机房、机柜、设备时，显示确认对话框
- **操作撤销：** 支持撤销最近的操作（如误删机柜，可撤销）
- **操作历史：** 显示最近的操作历史，支持快速撤销

**实现优先级：** 中

#### 8.8.8 打印和导出功能

**建议功能：**

- **打印布局：** 支持打印机房布局图，用于现场施工参考
- **导出报表：** 导出机房、机柜、设备列表为 Excel
- **导出统计：** 导出统计报表（容量使用情况、设备清单等）

#### 8.8.10 多语言支持

**建议功能：**

- **国际化：** 支持中英文切换（如项目已有国际化方案，需保持一致）
- **术语统一：** 确保专业术语翻译准确

**实现优先级：** 低（根据项目需求）

---

### 9.1 数据导入导出

- **数据模板：** 提供导入模板下载

<!-- ---

### 9.2 批量操作

**建议功能：**

- **批量编辑：** 批量修改机柜状态、容量等
- **批量删除：** 批量删除机房、机柜
- **批量移动：** 批量移动机柜到其他机房
- **批量导入设备：** 批量添加设备到机柜

**实现优先级：** 中

--- -->

<!-- ### 9.3 历史记录

**建议功能：**

- **操作日志：** 记录机房、机柜、设备的变更历史
- **布局历史：** 保存布局变更历史，支持回滚
- **版本对比：** 对比不同版本的布局差异

**实现优先级：** 低

--- -->

### 9.4 数据同步和缓存策略

**建议功能：**

- **数据缓存：** 使用 React Query 或 SWR 缓存机房、机柜数据，减少重复请求
- **乐观更新：** 用户操作立即更新 UI，后台同步到服务器
- **冲突处理：** 检测数据冲突，提示用户刷新或合并更改
- **离线支持：** 支持离线查看（使用缓存数据），上线后同步

**实现优先级：** 高（影响用户体验）

### 9.5 告警集成

**建议功能：**

- **容量告警：** U 位使用率、功率使用率告警
- **设备告警：** 设备离线、异常告警
- **告警展示：** 在机房卡片、统计面板中显示告警信息
- **告警处理：** 快速跳转到告警处理页面

**实现优先级：** 中

<!-- --- -->

<!-- ### 9.6 搜索增强

**建议功能：**

- **全局搜索：** 跨机房搜索机柜、设备
- **高级搜索：** 多条件组合搜索
- **搜索历史：** 保存常用搜索条件
- **搜索建议：** 智能搜索建议

**实现优先级：** 低

--- -->

### 9.7 快捷操作

**建议功能：**

- **快捷键支持：**
  - `Ctrl+S` 保存布局
  - `Ctrl+Z` 撤销
  - `Ctrl+Y` 重做
  - `Delete` 删除选中机柜
  - `R` 旋转机柜
- **右键菜单：** 丰富的右键菜单操作
- **拖拽操作：** 支持从 CMDB 拖拽设备到机柜

**实现优先级：** 中

---

### 9.8 性能优化

**建议功能：**

- **虚拟滚动：** 机柜列表、设备列表使用虚拟滚动
- **画布优化：** 大量机柜时使用 Canvas 渲染替代 DOM
- **懒加载：** 按需加载机柜详情、设备信息
- **缓存策略：** 缓存机房、机柜数据，减少 API 调用

**实现优先级：** 高（影响用户体验）

---

### 9.9 移动端适配

**建议功能：**

- **响应式布局：** 移动端自适应布局
- **触摸交互：** 支持触摸拖拽、缩放
- **简化功能：** 移动端隐藏复杂功能，保留核心查看功能

**实现优先级：** 低（主要面向桌面端用户）

---

### 9.10 数据统计大屏

**建议功能：**

- **统计大屏：** 机房整体统计可视化大屏
- **实时监控：** 实时显示机房状态、容量使用情况
- **趋势分析：** 容量使用趋势图表
- **多机房对比：** 多个机房数据对比

---

## 十、开发优先级建议

### 阶段一：核心功能（必须）✅ 已完成

### 阶段二：增强功能（重要）

1. CMDB 设备选择集成
2. 布局保存和加载
3. 统计信息展示
4. 搜索和筛选
5. 画布工具栏

### 阶段三：优化功能（可选）

1. 2.5D 视图
2. 批量操作
3. 数据导入导出
4. 快捷键支持
5. 性能优化

---

## 十一、技术实现要点

### 11.1 可视化画布实现

**技术方案：**

- 使用 `react-draggable` 或自定义拖拽实现
- 使用 CSS Transform 实现缩放和平移
- 使用 `useRef` 和 `useState` 管理画布状态
- 使用 `requestAnimationFrame` 优化渲染性能

**关键代码结构：**

```typescript
// 画布容器
<div className='room-canvas-container' ref={containerRef}>
  <div
    className='room-canvas'
    style={{
      transform: `translate(${canvasX}px, ${canvasY}px) scale(${canvasScale})`,
    }}
  >
    {racks.map((rack) => (
      <RackElement key={rack.id} rack={rack} />
    ))}
  </div>
</div>
```

---

### 11.2 U 位可视化实现

**技术方案：**

- 使用 Flexbox 垂直布局
- 每个 U 位使用固定高度（如 20px）
- 设备块使用绝对定位，跨多个 U 位
- 使用拖拽库实现设备位置调整

**关键代码结构：**

```typescript
// U位容器
<div className='u-unit-container'>
  {Array.from({ length: 42 }, (_, i) => i + 1)
    .reverse()
    .map((u) => (
      <UUnitItem key={u} u={u} devices={getDevicesAtU(u)} />
    ))}
</div>
```

---

### 11.3 状态管理实现

**技术方案：**

- 使用 React Context + useReducer
- 分离全局状态和局部状态
- 使用自定义 Hooks 封装业务逻辑

**关键代码结构：**

```typescript
// RoomContext
const RoomContext = createContext<RoomContextValue | null>(null);

// RoomProvider
export const RoomProvider: React.FC = ({ children, roomId }) => {
  const [state, dispatch] = useReducer(roomReducer, initialState);
  // ...
  return <RoomContext.Provider value={value}>{children}</RoomContext.Provider>;
};
```

---

## 十二、测试计划

### 12.1 单元测试

- 组件渲染测试
- 交互逻辑测试
- 工具函数测试

### 12.2 集成测试

- API 调用测试
- 数据流测试
- 用户操作流程测试

### 12.3 E2E 测试

- 完整业务流程测试
- 跨页面操作测试
- 性能测试

---

## 十三、设计讨论总结

### 13.1 核心设计决策

#### 13.1.1 布局方案

经过讨论，确定了以下核心布局方案：

1. **IDC 管理主页面：** Tab 页布局，分离机房管理和机柜管理
2. **机房列表页：** 卡片式布局，响应式网格，每行 3-4 个机房卡片
3. **机房详情页：** 三栏布局（左侧工具栏 300px + 中间画布自适应 + 右侧信息栏 350px）
4. **机柜管理页面：** Table 表格布局，支持搜索、筛选、排序、批量操作
5. **机柜详情：** 抽屉式布局，上下分栏（U 位可视化 + 设备列表）

**关键优化点：**

- Tab 页设计：机房管理和机柜管理分离，职责清晰
- 机柜独立管理：机柜可以在机柜管理页面独立创建和管理
- 机柜选择功能：在机房详情页添加机柜时，从机柜管理中选择
- 支持响应式调整，小屏幕时工具栏和信息栏可折叠
- 提供全屏画布模式，专注布局编辑
- 支持用户自定义布局偏好

#### 13.1.2 可视化方案

**推荐方案：**

- **优先实现 2D 视图：** 基于 CSS Transform，性能好，交互简单
- **2.5D 视图作为可选：** 视觉效果更好，但实现复杂，性能开销大

**机柜排列：**

- **自由拖拽布局（主要）：** 机柜可任意拖拽，支持网格对齐
- **自动排列布局（辅助）：** 快速查看模式，自动横向排列

#### 13.1.3 U 位管理方案

**设计要点：**

- 垂直列表，从上到下显示 42U
- 每个 U 位高度 20-25px
- 设备块跨多个 U 位，使用绝对定位
- 支持拖拽调整设备位置
- 颜色区分设备状态（在线/离线/告警/维护）

### 13.2 关键功能补充

#### 13.2.1 必须实现的功能（高优先级）

1. **设备快速搜索和定位**

   - 全局设备搜索，跨机房搜索
   - 自动定位到对应机柜并高亮

2. **设备详情快速查看**

   - 点击设备显示详情弹窗
   - 不跳转页面，提升操作效率

3. **机柜容量预警**

   - U 位使用率、功率使用率预警
   - 在机柜卡片、统计面板中显示

4. **权限控制集成**

   - 根据用户权限控制操作可见性
   - 数据权限控制

5. **数据同步和缓存策略**
   - 使用 React Query 或 SWR 缓存数据
   - 乐观更新，冲突处理

#### 13.2.2 建议实现的功能（中优先级）

1. **机柜模板功能** - 快速创建机柜
2. **机柜分组和标签** - 便于分类管理
3. **布局导入导出** - 批量操作和模板管理
4. **操作确认和撤销** - 防止误操作
5. **打印和导出功能** - 报表和布局图导出
6. **告警集成** - 容量和设备告警展示

#### 13.2.3 可选功能（低优先级）

1. **历史记录** - 操作日志和布局历史
2. **搜索增强** - 高级搜索、搜索历史
3. **快捷操作** - 快捷键支持
4. **移动端适配** - 响应式布局
5. **数据统计大屏** - 可视化大屏

### 13.3 交互设计要点

#### 13.3.1 画布交互

- **拖拽平移：** 鼠标中键或空格+左键
- **机柜拖拽：** 左键拖拽移动
- **机柜旋转：** 选中后右键菜单或快捷键 R
- **双击机柜：** 打开详情抽屉
- **单击机柜：** 选中机柜，右侧显示详情

#### 13.3.2 布局保存策略

- **自动保存：** 拖拽后延迟 2-3 秒自动保存（防抖）
- **手动保存：** 提供保存按钮，用户可手动触发
- **保存状态提示：** 显示保存中/已保存/保存失败

#### 13.3.3 错误处理

- **友好提示：** 网络错误、权限错误、数据冲突等场景的友好提示
- **重试机制：** 提供重试按钮
- **数据保留：** 操作失败时保留用户输入

### 13.4 性能优化建议

1. **虚拟滚动：** 机柜列表、设备列表使用虚拟滚动
2. **画布优化：** 大量机柜时考虑使用 Canvas 渲染
3. **懒加载：** 按需加载机柜详情、设备信息
4. **缓存策略：** 缓存机房、机柜数据，减少 API 调用

### 13.5 与后端 API 对接要点

根据后端设计文档，需要注意以下对接要点：

1. **设备关联：** 通过 `rack_devices` 表关联 CMDB 的 `asset` 表
2. **机柜和机房名称：** 通过关联查询获取，确保返回名称而非 ID
3. **U 位验证：** 使用 `POST /cmdb/racks/:rackId/check-u-position` 接口验证冲突
4. **统计接口：** 使用统计接口获取实时容量数据
5. **CMDB 集成：** 使用 `GET /cmdb/assets` 接口查询设备列表

### 13.6 待确认的问题

1. **机柜尺寸标准：** 是否需要支持非标准尺寸机柜？
2. **布局单位：** 画布使用米还是像素作为单位？
3. **多用户协作：** 是否需要实时同步（WebSocket）？
4. **数据权限：** 权限控制的具体规则是什么？
5. **告警集成：** 告警数据来源和展示方式？

---

## 十四、总结

本设计文档详细规划了 IDC 机房管理模块的前端 UI 架构和组件设计，包括：

1. **完整的页面结构：** IDC 管理主页面（Tab 页）、机房列表页、机房详情页、机柜管理页面、机柜详情视图
2. **清晰的组件划分：** 页面级组件、业务组件、通用组件
3. **合理的布局设计：** Tab 页布局分离机房和机柜管理，三栏布局展示机房详情，Table 表格展示机柜列表
4. **详细的交互设计：** 画布交互、U 位管理交互、设备管理交互、机柜管理交互
5. **机柜管理功能：** 机柜独立管理（CRUD）、机柜选择功能、批量操作、容量信息展示
6. **扩展功能建议：** 数据导入导出、批量操作、权限控制、告警集成等
7. **深入的功能布局讨论：** 布局方案对比、可视化方案选择、U 位管理优化、机柜管理设计等
8. **未考虑功能点补充：** 设备快速搜索、容量预警、操作撤销等

设计遵循了以下原则：

- **用户友好：** 符合运维人员使用习惯，操作直观便捷
- **信息直观：** 关键信息一目了然，状态清晰可见
- **操作便捷：** 减少操作步骤，提高工作效率
- **性能优化：** 考虑大数据量场景，使用虚拟滚动、懒加载等优化手段
- **可扩展性：** 预留扩展接口，支持后续功能迭代
- **一致性：** 与系统整体风格保持一致，遵循 Ant Design 设计规范

**开发建议：**

1. **分阶段实现：** 按照开发优先级，先完成核心功能，再逐步完善增强功能
2. **原型验证：** 建议先实现核心页面的原型，验证布局和交互的合理性
3. **用户反馈：** 在开发过程中收集用户反馈，及时调整设计方案
4. **性能测试：** 在大量数据场景下进行性能测试，确保用户体验

建议按照开发优先级分阶段实现，先完成核心功能，再逐步完善增强功能和优化功能。
